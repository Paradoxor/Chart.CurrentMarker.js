/*!
 * Chart.CurrentMarker.js
 * http://www.threerabbits.io/opensource/
 * Version: 0.1.0
 *
 * Copyright 2016 Pascal Ehlert
 * Released under the MIT license
 * https://github.com/pehlert/Chart.CurrentMarker.js/blob/master/LICENSE.md
 */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),CurrentMarkerLine=function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.config=e.config||{},n.config={lineWidth:e.config.lineWidth||1,lineColor:e.config.lineColor||"rgba(46, 153, 122, 1)",lineDash:e.config.lineDash||[5,3],textColor:e.config.textColor||"rgb(255, 255, 255)",font:e.config.font||"18px Helvetica"},n}return _inherits(t,e),_createClass(t,[{key:"draw",value:function(e){e.save();var t=this._view;e.lineWidth=this.config.lineWidth,e.lineColor=this.config.lineColor,e.fillStyle=this.config.lineColor,e.setLineDash(this.config.lineDash);var n=100,r=15,i=30,o=5;e.beginPath(),e.moveTo(t.x1,t.y1),e.lineTo(t.x2-n-r-o,t.y2),e.stroke();var l=t.y2-i/2,a=t.x2-n;e.fillRect(a,l,n,i);var c=a-r,s=l+i/2;e.setLineDash([0]),e.beginPath(),e.moveTo(c,s),e.lineTo(a,l),e.lineTo(a,l+i),e.fill(),e.fillStyle=this.config.textColor,e.font=this.config.font,e.textBaseLine="middle",e.textAlign="center",e.fillText(t.valueText,a+n/2,t.y2+5),e.restore()}}]),t}(Chart.Element),CurrentMarkerPlugin=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"beforeInit",value:function(e){this.config=e.options.currentMarker||{},e._currentMarker=new CurrentMarkerLine({_index:0,config:this.config})}},{key:"afterDraw",value:function(e,t){var n=e.data.datasets[0].data,r=n[n.length-1],i=e.chart.ctx,o=e._currentMarker,l=o._model=o._model||{},a=e.scales["y-axis-1"],c=a?a.getPixelForValue(r):NaN,s=e.chartArea;isNaN(c)||(l.x1=s.left,l.x2=s.right,l.y1=l.y2=c,l.valueText=r.y.toFixed(this.config.decimals||0)),e._currentMarker.transition(t).draw(i)}}]),t}(Chart.PluginBase);Chart.pluginService.register(new CurrentMarkerPlugin);